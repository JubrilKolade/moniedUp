generator client {
  provider = "prisma-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String   @id @default(uuid())
  name            String
  email           String   @unique
  password        String
  phone           String
  address         String
  tier            String   @default("Tier1") // Tier1, Tier2, Tier3
  kycStatus       String   @default("unverified") // unverified, pending, verified
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  twoFactorSecret String?
  accounts        Account[]
  sentTransactions     Transaction[] @relation("PerformedBy")
}

model Admin {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  phone     String
  role      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  id            String   @id @default(uuid())
  accountNumber String   @unique
  type          String
  balance       Float    @default(0)
  status        String   @default("active")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  cards         Card[]
  sentTransactions     Transaction[] @relation("FromAccount")
  receivedTransactions Transaction[] @relation("ToAccount")
}

model Transaction {
  id                String   @id @default(uuid())
  amount            Float
  type              String
  status            String   @default("pending")
  description       String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  fromAccountId     String?
  fromAccount       Account? @relation("FromAccount", fields: [fromAccountId], references: [id])
  toAccountId       String?
  toAccount         Account? @relation("ToAccount", fields: [toAccountId], references: [id])
  performedByUserId String?
  performedBy       User?    @relation("PerformedBy", fields: [performedByUserId], references: [id])
}

model Card {
  id         String   @id @default(uuid())
  cardNumber String   @unique
  type       String
  status     String   @default("active")
  expiryDate DateTime
  cvv        String
  issuedAt   DateTime @default(now())
  accountId  String
  account    Account  @relation(fields: [accountId], references: [id])
}